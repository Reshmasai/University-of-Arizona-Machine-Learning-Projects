<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>8ea018607c014e93adf19d1dffd5241c</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="pre-trained-language-models-subtask-c"
class="cell markdown" data-deletable="false" data-editable="false"
id="zDBF1PXEDfhw">
<h1>Pre-trained Language Models: SubTask C</h1>
<h2 id="8-marks">[8 Marks]</h2>
<p>In this assignment, you will work on the <a
href="https://competitions.codalab.org/competitions/21080">ComVE</a>
shared task that was part of SemEval-2020. The task aims to evaluate
whether a system can distinguish if a natural language statement makes
sense to humans or not and provide a reason. <strong>ConVE</strong>
includes three subtasks that require models to acquire and apply
commonsense knowledge. In this notebook you will focus on
<strong>SubTask C</strong>:</p>
<ul>
<li><p>Given a statement that does not make sense, generate the reason
why this statement does not make sense. For each nonsensical statement,
three valid reasons are given as reference:</p>
<p><em>Statement</em>: He put an elephant into the fridge.<br />
<em>Reason A</em>: An elephant is much bigger than a fridge.<br />
<em>Reason B</em>: A fridge is much smaller than an elephant.<br />
<em>Reason C</em>: Most of the fridges aren't large enough to contain an
elephant.</p>
<p>This subtask can be approached as a Sequence-to-Sequence problem
where the input is the nonsensical statement and the output is a valid
reason.</p></li>
</ul>
<p>You will fine-tune a Pre-trained Language Model with <a
href="https://huggingface.co/docs/transformers/index">Transformers</a>
library that provides a set of tools for fine-tunning and deploying a
wide variety of Pre-trained Language Models. The <a
href="https://huggingface.co/models">Hugging Face Hub</a> allows you to
explore all the models supported by <strong>Transformers</strong> and
even share your own models with the community. In this assignment, you
will work with <a
href="https://huggingface.co/docs/transformers/model_doc/bart">BART</a>,
a pre-trained Sequence-to-Sequence model.</p>
<p>Fine-tuning a Pre-trained Language Model usually requires a great
amount of time and computational resources. Your personal computer will
not be enough. In order to complete the assignment, you can work with a
reduced version of the dataset and the base version of
<strong>BART</strong>:</p>
</section>
<div class="cell code" data-execution_count="4"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="1ZSJ8x_Y1hay" data-outputId="78981123-065e-4038-be6d-94086aff9514">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>r <span class="st">&#39;/content/sample_data/Assessment+4_+requirements.txt&#39;</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>Requirement already satisfied: ipython==7.34.0 in /usr/local/lib/python3.10/dist-packages (from -r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (7.34.0)
Collecting jupyter==1.0.0 (from -r /content/sample_data/Assessment+4_+requirements.txt (line 2))
  Downloading jupyter-1.0.0-py2.py3-none-any.whl (2.7 kB)
Collecting nbimporter==0.3.4 (from -r /content/sample_data/Assessment+4_+requirements.txt (line 3))
  Downloading nbimporter-0.3.4-py3-none-any.whl (4.9 kB)
Collecting pytest==7.1.3 (from -r /content/sample_data/Assessment+4_+requirements.txt (line 4))
  Downloading pytest-7.1.3-py3-none-any.whl (298 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 298.2/298.2 kB 8.1 MB/s eta 0:00:00
ent already satisfied: pandas==2.0.3 in /usr/local/lib/python3.10/dist-packages (from -r /content/sample_data/Assessment+4_+requirements.txt (line 5)) (2.0.3)
Requirement already satisfied: tensorflow==2.15 in /usr/local/lib/python3.10/dist-packages (from -r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (2.15.0)
Requirement already satisfied: torch==2.3.0 in /usr/local/lib/python3.10/dist-packages (from -r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (2.3.0+cu121)
Collecting transformers==4.23.1 (from -r /content/sample_data/Assessment+4_+requirements.txt (line 8))
  Downloading transformers-4.23.1-py3-none-any.whl (5.3 MB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 5.3/5.3 MB 22.2 MB/s eta 0:00:00
 -r /content/sample_data/Assessment+4_+requirements.txt (line 9))
  Downloading datasets-2.11.0-py3-none-any.whl (468 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 468.7/468.7 kB 34.1 MB/s eta 0:00:00
 -r /content/sample_data/Assessment+4_+requirements.txt (line 10))
  Downloading evaluate-0.4.0-py3-none-any.whl (81 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 81.4/81.4 kB 14.3 MB/s eta 0:00:00
 -r /content/sample_data/Assessment+4_+requirements.txt (line 11))
  Downloading rouge_score-0.1.2.tar.gz (17 kB)
  Preparing metadata (setup.py) ... ent already satisfied: setuptools&gt;=18.5 in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (67.7.2)
Collecting jedi&gt;=0.16 (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1))
  Downloading jedi-0.19.1-py2.py3-none-any.whl (1.6 MB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.6/1.6 MB 44.0 MB/s eta 0:00:00
ent already satisfied: decorator in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (4.4.2)
Requirement already satisfied: pickleshare in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (0.7.5)
Requirement already satisfied: traitlets&gt;=4.2 in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (5.7.1)
Requirement already satisfied: prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0 in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (3.0.47)
Requirement already satisfied: pygments in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (2.16.1)
Requirement already satisfied: backcall in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (0.2.0)
Requirement already satisfied: matplotlib-inline in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (0.1.7)
Requirement already satisfied: pexpect&gt;4.3 in /usr/local/lib/python3.10/dist-packages (from ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (4.9.0)
Requirement already satisfied: notebook in /usr/local/lib/python3.10/dist-packages (from jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (6.5.5)
Collecting qtconsole (from jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2))
  Downloading qtconsole-5.5.2-py3-none-any.whl (123 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 123.4/123.4 kB 16.8 MB/s eta 0:00:00
ent already satisfied: jupyter-console in /usr/local/lib/python3.10/dist-packages (from jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (6.1.0)
Requirement already satisfied: nbconvert in /usr/local/lib/python3.10/dist-packages (from jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (6.5.4)
Requirement already satisfied: ipykernel in /usr/local/lib/python3.10/dist-packages (from jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (5.5.6)
Requirement already satisfied: ipywidgets in /usr/local/lib/python3.10/dist-packages (from jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (7.7.1)
Requirement already satisfied: attrs&gt;=19.2.0 in /usr/local/lib/python3.10/dist-packages (from pytest==7.1.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 4)) (23.2.0)
Requirement already satisfied: iniconfig in /usr/local/lib/python3.10/dist-packages (from pytest==7.1.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 4)) (2.0.0)
Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from pytest==7.1.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 4)) (24.1)
Requirement already satisfied: pluggy&lt;2.0,&gt;=0.12 in /usr/local/lib/python3.10/dist-packages (from pytest==7.1.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 4)) (1.5.0)
Collecting py&gt;=1.8.2 (from pytest==7.1.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 4))
  Downloading py-1.11.0-py2.py3-none-any.whl (98 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 98.7/98.7 kB 17.0 MB/s eta 0:00:00
ent already satisfied: tomli&gt;=1.0.0 in /usr/local/lib/python3.10/dist-packages (from pytest==7.1.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 4)) (2.0.1)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /usr/local/lib/python3.10/dist-packages (from pandas==2.0.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 5)) (2.8.2)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas==2.0.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 5)) (2023.4)
Requirement already satisfied: tzdata&gt;=2022.1 in /usr/local/lib/python3.10/dist-packages (from pandas==2.0.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 5)) (2024.1)
Requirement already satisfied: numpy&gt;=1.21.0 in /usr/local/lib/python3.10/dist-packages (from pandas==2.0.3-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 5)) (1.25.2)
Requirement already satisfied: absl-py&gt;=1.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (1.4.0)
Requirement already satisfied: astunparse&gt;=1.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (1.6.3)
Requirement already satisfied: flatbuffers&gt;=23.5.26 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (24.3.25)
Requirement already satisfied: gast!=0.5.0,!=0.5.1,!=0.5.2,&gt;=0.2.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (0.5.4)
Requirement already satisfied: google-pasta&gt;=0.1.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (0.2.0)
Requirement already satisfied: h5py&gt;=2.9.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (3.9.0)
Requirement already satisfied: libclang&gt;=13.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (18.1.1)
Requirement already satisfied: ml-dtypes~=0.2.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (0.2.0)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (3.3.0)
Requirement already satisfied: protobuf!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,&lt;5.0.0dev,&gt;=3.20.3 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (3.20.3)
Requirement already satisfied: six&gt;=1.12.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (1.16.0)
Requirement already satisfied: termcolor&gt;=1.1.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (2.4.0)
Requirement already satisfied: typing-extensions&gt;=3.6.6 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (4.12.2)
Requirement already satisfied: wrapt&lt;1.15,&gt;=1.11.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (1.14.1)
Requirement already satisfied: tensorflow-io-gcs-filesystem&gt;=0.23.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (0.37.0)
Requirement already satisfied: grpcio&lt;2.0,&gt;=1.24.3 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (1.64.1)
Requirement already satisfied: tensorboard&lt;2.16,&gt;=2.15 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (2.15.2)
Requirement already satisfied: tensorflow-estimator&lt;2.16,&gt;=2.15.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (2.15.0)
Requirement already satisfied: keras&lt;2.16,&gt;=2.15.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (2.15.0)
Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (3.15.3)
Requirement already satisfied: sympy in /usr/local/lib/python3.10/dist-packages (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (1.12.1)
Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (3.3)
Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (3.1.4)
Requirement already satisfied: fsspec in /usr/local/lib/python3.10/dist-packages (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (2023.6.0)
Collecting nvidia-cuda-nvrtc-cu12==12.1.105 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_cuda_nvrtc_cu12-12.1.105-py3-none-manylinux1_x86_64.whl (23.7 MB)
Collecting nvidia-cuda-runtime-cu12==12.1.105 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_cuda_runtime_cu12-12.1.105-py3-none-manylinux1_x86_64.whl (823 kB)
Collecting nvidia-cuda-cupti-cu12==12.1.105 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_cuda_cupti_cu12-12.1.105-py3-none-manylinux1_x86_64.whl (14.1 MB)
Collecting nvidia-cudnn-cu12==8.9.2.26 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_cudnn_cu12-8.9.2.26-py3-none-manylinux1_x86_64.whl (731.7 MB)
Collecting nvidia-cublas-cu12==12.1.3.1 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_cublas_cu12-12.1.3.1-py3-none-manylinux1_x86_64.whl (410.6 MB)
Collecting nvidia-cufft-cu12==11.0.2.54 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_cufft_cu12-11.0.2.54-py3-none-manylinux1_x86_64.whl (121.6 MB)
Collecting nvidia-curand-cu12==10.3.2.106 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_curand_cu12-10.3.2.106-py3-none-manylinux1_x86_64.whl (56.5 MB)
Collecting nvidia-cusolver-cu12==11.4.5.107 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_cusolver_cu12-11.4.5.107-py3-none-manylinux1_x86_64.whl (124.2 MB)
Collecting nvidia-cusparse-cu12==12.1.0.106 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_cusparse_cu12-12.1.0.106-py3-none-manylinux1_x86_64.whl (196.0 MB)
Collecting nvidia-nccl-cu12==2.20.5 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_nccl_cu12-2.20.5-py3-none-manylinux2014_x86_64.whl (176.2 MB)
Collecting nvidia-nvtx-cu12==12.1.105 (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Using cached nvidia_nvtx_cu12-12.1.105-py3-none-manylinux1_x86_64.whl (99 kB)
Requirement already satisfied: triton==2.3.0 in /usr/local/lib/python3.10/dist-packages (from torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (2.3.0)
Requirement already satisfied: huggingface-hub&lt;1.0,&gt;=0.10.0 in /usr/local/lib/python3.10/dist-packages (from transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (0.23.4)
Requirement already satisfied: pyyaml&gt;=5.1 in /usr/local/lib/python3.10/dist-packages (from transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (6.0.1)
Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.10/dist-packages (from transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (2024.5.15)
Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (2.31.0)
Collecting tokenizers!=0.11.3,&lt;0.14,&gt;=0.11.1 (from transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8))
  Downloading tokenizers-0.13.3-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (7.8 MB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 7.8/7.8 MB 67.6 MB/s eta 0:00:00
ent already satisfied: tqdm&gt;=4.27 in /usr/local/lib/python3.10/dist-packages (from transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (4.66.4)
Requirement already satisfied: pyarrow&gt;=8.0.0 in /usr/local/lib/python3.10/dist-packages (from datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9)) (14.0.2)
Collecting dill&lt;0.3.7,&gt;=0.3.0 (from datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9))
  Downloading dill-0.3.6-py3-none-any.whl (110 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 110.5/110.5 kB 17.7 MB/s eta 0:00:00
 datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9))
  Downloading xxhash-3.4.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (194 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 194.1/194.1 kB 29.7 MB/s eta 0:00:00
ultiprocess (from datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9))
  Downloading multiprocess-0.70.16-py310-none-any.whl (134 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 134.8/134.8 kB 20.9 MB/s eta 0:00:00
ent already satisfied: aiohttp in /usr/local/lib/python3.10/dist-packages (from datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9)) (3.9.5)
Collecting responses&lt;0.19 (from datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9))
  Downloading responses-0.18.0-py3-none-any.whl (38 kB)
Requirement already satisfied: nltk in /usr/local/lib/python3.10/dist-packages (from rouge-score==0.1.2-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 11)) (3.8.1)
Collecting nvidia-nvjitlink-cu12 (from nvidia-cusolver-cu12==11.4.5.107-&gt;torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7))
  Downloading nvidia_nvjitlink_cu12-12.5.40-py3-none-manylinux2014_x86_64.whl (21.3 MB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 21.3/21.3 MB 90.1 MB/s eta 0:00:00
ent already satisfied: wheel&lt;1.0,&gt;=0.23.0 in /usr/local/lib/python3.10/dist-packages (from astunparse&gt;=1.6.0-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (0.43.0)
Requirement already satisfied: aiosignal&gt;=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9)) (1.3.1)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9)) (1.4.1)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9)) (6.0.5)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9)) (1.9.4)
Requirement already satisfied: async-timeout&lt;5.0,&gt;=4.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp-&gt;datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9)) (4.0.3)
Requirement already satisfied: parso&lt;0.9.0,&gt;=0.8.3 in /usr/local/lib/python3.10/dist-packages (from jedi&gt;=0.16-&gt;ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (0.8.4)
Requirement already satisfied: ptyprocess&gt;=0.5 in /usr/local/lib/python3.10/dist-packages (from pexpect&gt;4.3-&gt;ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (0.7.0)
Requirement already satisfied: wcwidth in /usr/local/lib/python3.10/dist-packages (from prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0-&gt;ipython==7.34.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 1)) (0.2.13)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.10/dist-packages (from requests-&gt;transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from requests-&gt;transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests-&gt;transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (2.0.7)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests-&gt;transformers==4.23.1-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 8)) (2024.6.2)
Requirement already satisfied: google-auth&lt;3,&gt;=1.6.3 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (2.27.0)
Requirement already satisfied: google-auth-oauthlib&lt;2,&gt;=0.5 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (1.2.0)
Requirement already satisfied: markdown&gt;=2.6.8 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (3.6)
Requirement already satisfied: tensorboard-data-server&lt;0.8.0,&gt;=0.7.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (0.7.2)
Requirement already satisfied: werkzeug&gt;=1.0.1 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (3.0.3)
Requirement already satisfied: ipython-genutils in /usr/local/lib/python3.10/dist-packages (from ipykernel-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.2.0)
Requirement already satisfied: jupyter-client in /usr/local/lib/python3.10/dist-packages (from ipykernel-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (6.1.12)
Requirement already satisfied: tornado&gt;=4.2 in /usr/local/lib/python3.10/dist-packages (from ipykernel-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (6.3.3)
Requirement already satisfied: widgetsnbextension~=3.6.0 in /usr/local/lib/python3.10/dist-packages (from ipywidgets-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (3.6.6)
Requirement already satisfied: jupyterlab-widgets&gt;=1.0.0 in /usr/local/lib/python3.10/dist-packages (from ipywidgets-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (3.0.11)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /usr/local/lib/python3.10/dist-packages (from jinja2-&gt;torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (2.1.5)
INFO: pip is looking at multiple versions of multiprocess to determine which version is compatible with other requirements. This could take a while.
Collecting multiprocess (from datasets==2.11.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 9))
  Downloading multiprocess-0.70.15-py310-none-any.whl (134 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 134.8/134.8 kB 17.8 MB/s eta 0:00:00
ultiprocess-0.70.14-py310-none-any.whl (134 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 134.3/134.3 kB 20.9 MB/s eta 0:00:00
ent already satisfied: lxml in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (4.9.4)
Requirement already satisfied: beautifulsoup4 in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (4.12.3)
Requirement already satisfied: bleach in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (6.1.0)
Requirement already satisfied: defusedxml in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.7.1)
Requirement already satisfied: entrypoints&gt;=0.2.2 in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.4)
Requirement already satisfied: jupyter-core&gt;=4.7 in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (5.7.2)
Requirement already satisfied: jupyterlab-pygments in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.3.0)
Requirement already satisfied: mistune&lt;2,&gt;=0.8.1 in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.8.4)
Requirement already satisfied: nbclient&gt;=0.5.0 in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.10.0)
Requirement already satisfied: nbformat&gt;=5.1 in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (5.10.4)
Requirement already satisfied: pandocfilters&gt;=1.4.1 in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.5.1)
Requirement already satisfied: tinycss2 in /usr/local/lib/python3.10/dist-packages (from nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.3.0)
Requirement already satisfied: click in /usr/local/lib/python3.10/dist-packages (from nltk-&gt;rouge-score==0.1.2-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 11)) (8.1.7)
Requirement already satisfied: joblib in /usr/local/lib/python3.10/dist-packages (from nltk-&gt;rouge-score==0.1.2-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 11)) (1.4.2)
Requirement already satisfied: pyzmq&lt;25,&gt;=17 in /usr/local/lib/python3.10/dist-packages (from notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (24.0.1)
Requirement already satisfied: argon2-cffi in /usr/local/lib/python3.10/dist-packages (from notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (23.1.0)
Requirement already satisfied: nest-asyncio&gt;=1.5 in /usr/local/lib/python3.10/dist-packages (from notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.6.0)
Requirement already satisfied: Send2Trash&gt;=1.8.0 in /usr/local/lib/python3.10/dist-packages (from notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.8.3)
Requirement already satisfied: terminado&gt;=0.8.3 in /usr/local/lib/python3.10/dist-packages (from notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.18.1)
Requirement already satisfied: prometheus-client in /usr/local/lib/python3.10/dist-packages (from notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.20.0)
Requirement already satisfied: nbclassic&gt;=0.4.7 in /usr/local/lib/python3.10/dist-packages (from notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.1.0)
Collecting qtpy&gt;=2.4.0 (from qtconsole-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2))
  Downloading QtPy-2.4.1-py3-none-any.whl (93 kB)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 93.5/93.5 kB 12.2 MB/s eta 0:00:00
ent already satisfied: mpmath&lt;1.4.0,&gt;=1.1.0 in /usr/local/lib/python3.10/dist-packages (from sympy-&gt;torch==2.3.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 7)) (1.3.0)
Requirement already satisfied: cachetools&lt;6.0,&gt;=2.0.0 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (5.3.3)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (0.4.0)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (4.9)
Requirement already satisfied: requests-oauthlib&gt;=0.7.0 in /usr/local/lib/python3.10/dist-packages (from google-auth-oauthlib&lt;2,&gt;=0.5-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (1.3.1)
Requirement already satisfied: platformdirs&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from jupyter-core&gt;=4.7-&gt;nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (4.2.2)
Requirement already satisfied: notebook-shim&gt;=0.2.3 in /usr/local/lib/python3.10/dist-packages (from nbclassic&gt;=0.4.7-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.2.4)
Requirement already satisfied: fastjsonschema&gt;=2.15 in /usr/local/lib/python3.10/dist-packages (from nbformat&gt;=5.1-&gt;nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (2.20.0)
Requirement already satisfied: jsonschema&gt;=2.6 in /usr/local/lib/python3.10/dist-packages (from nbformat&gt;=5.1-&gt;nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (4.19.2)
Requirement already satisfied: argon2-cffi-bindings in /usr/local/lib/python3.10/dist-packages (from argon2-cffi-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (21.2.0)
Requirement already satisfied: soupsieve&gt;1.2 in /usr/local/lib/python3.10/dist-packages (from beautifulsoup4-&gt;nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (2.5)
Requirement already satisfied: webencodings in /usr/local/lib/python3.10/dist-packages (from bleach-&gt;nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.5.1)
Requirement already satisfied: jsonschema-specifications&gt;=2023.03.6 in /usr/local/lib/python3.10/dist-packages (from jsonschema&gt;=2.6-&gt;nbformat&gt;=5.1-&gt;nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (2023.12.1)
Requirement already satisfied: referencing&gt;=0.28.4 in /usr/local/lib/python3.10/dist-packages (from jsonschema&gt;=2.6-&gt;nbformat&gt;=5.1-&gt;nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.35.1)
Requirement already satisfied: rpds-py&gt;=0.7.1 in /usr/local/lib/python3.10/dist-packages (from jsonschema&gt;=2.6-&gt;nbformat&gt;=5.1-&gt;nbconvert-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (0.18.1)
Requirement already satisfied: jupyter-server&lt;3,&gt;=1.8 in /usr/local/lib/python3.10/dist-packages (from notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.24.0)
Requirement already satisfied: pyasn1&lt;0.7.0,&gt;=0.4.6 in /usr/local/lib/python3.10/dist-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (0.6.0)
Requirement already satisfied: oauthlib&gt;=3.0.0 in /usr/local/lib/python3.10/dist-packages (from requests-oauthlib&gt;=0.7.0-&gt;google-auth-oauthlib&lt;2,&gt;=0.5-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow==2.15-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 6)) (3.2.2)
Requirement already satisfied: cffi&gt;=1.0.1 in /usr/local/lib/python3.10/dist-packages (from argon2-cffi-bindings-&gt;argon2-cffi-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.16.0)
Requirement already satisfied: pycparser in /usr/local/lib/python3.10/dist-packages (from cffi&gt;=1.0.1-&gt;argon2-cffi-bindings-&gt;argon2-cffi-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (2.22)
Requirement already satisfied: anyio&lt;4,&gt;=3.1.0 in /usr/local/lib/python3.10/dist-packages (from jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (3.7.1)
Requirement already satisfied: websocket-client in /usr/local/lib/python3.10/dist-packages (from jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.8.0)
Requirement already satisfied: sniffio&gt;=1.1 in /usr/local/lib/python3.10/dist-packages (from anyio&lt;4,&gt;=3.1.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.3.1)
Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anyio&lt;4,&gt;=3.1.0-&gt;jupyter-server&lt;3,&gt;=1.8-&gt;notebook-shim&gt;=0.2.3-&gt;nbclassic&gt;=0.4.7-&gt;notebook-&gt;jupyter==1.0.0-&gt;-r /content/sample_data/Assessment+4_+requirements.txt (line 2)) (1.2.1)
Building wheels for collected packages: rouge-score
  Building wheel for rouge-score (setup.py) ... e=rouge_score-0.1.2-py3-none-any.whl size=24933 sha256=fdb8dc639aa5b617c8160ca57f98a3ec40fcb5e74a8ce38febb1e0a405aca684
  Stored in directory: /root/.cache/pip/wheels/5f/dd/89/461065a73be61a532ff8599a28e9beef17985c9e9c31e541b4
Successfully built rouge-score
Installing collected packages: tokenizers, nbimporter, xxhash, qtpy, py, nvidia-nvtx-cu12, nvidia-nvjitlink-cu12, nvidia-nccl-cu12, nvidia-curand-cu12, nvidia-cufft-cu12, nvidia-cuda-runtime-cu12, nvidia-cuda-nvrtc-cu12, nvidia-cuda-cupti-cu12, nvidia-cublas-cu12, jedi, dill, rouge-score, responses, pytest, nvidia-cusparse-cu12, nvidia-cudnn-cu12, multiprocess, transformers, nvidia-cusolver-cu12, qtconsole, datasets, evaluate, jupyter
  Attempting uninstall: tokenizers
    Found existing installation: tokenizers 0.19.1
    Uninstalling tokenizers-0.19.1:
      Successfully uninstalled tokenizers-0.19.1
  Attempting uninstall: pytest
    Found existing installation: pytest 7.4.4
    Uninstalling pytest-7.4.4:
      Successfully uninstalled pytest-7.4.4
  Attempting uninstall: transformers
    Found existing installation: transformers 4.41.2
    Uninstalling transformers-4.41.2:
      Successfully uninstalled transformers-4.41.2
Successfully installed datasets-2.11.0 dill-0.3.6 evaluate-0.4.0 jedi-0.19.1 jupyter-1.0.0 multiprocess-0.70.14 nbimporter-0.3.4 nvidia-cublas-cu12-12.1.3.1 nvidia-cuda-cupti-cu12-12.1.105 nvidia-cuda-nvrtc-cu12-12.1.105 nvidia-cuda-runtime-cu12-12.1.105 nvidia-cudnn-cu12-8.9.2.26 nvidia-cufft-cu12-11.0.2.54 nvidia-curand-cu12-10.3.2.106 nvidia-cusolver-cu12-11.4.5.107 nvidia-cusparse-cu12-12.1.0.106 nvidia-nccl-cu12-2.20.5 nvidia-nvjitlink-cu12-12.5.40 nvidia-nvtx-cu12-12.1.105 py-1.11.0 pytest-7.1.3 qtconsole-5.5.2 qtpy-2.4.1 responses-0.18.0 rouge-score-0.1.2 tokenizers-0.13.3 transformers-4.23.1 xxhash-3.4.1
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="5" id="X6DavXXpDfhy">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>shrink_dataset <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>base_model <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>colab <span class="op">=</span> <span class="va">False</span></span></code></pre></div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="fI5Uu0_gDfhz">
<p>Although the value of these variables do not affect the tests that
will evaluate your code, the output examples distributed throughout this
notebook are based on a <code>shrink_dataset</code> and a
<code>base_model</code> variables set as <code>True</code>, and a
<code>colab</code> variable set as <code>False</code>.</p>
<p>If you want to perform a full training of the model to obtain its
real performance, you can use a cloud service like <a
href="https://colab.research.google.com/">Google Colab</a>.
<strong>Colab</strong> is a <strong>Jupyter</strong> notebook
environment that supports both GPU and TPU instances, allowing training
large scale Deep Learning models. Set the <code>shrink_dataset</code>
and a <code>base_model</code> variables to <code>False</code>, the
<code>colab</code> variable to <code>True</code>, and follow the
instructions provided to you to run the notebook in
<strong>Colab</strong>.</p>
</div>
<div class="cell code" data-execution_count="6" data-deletable="false"
data-editable="false" id="gEqfRl12Dfhz">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> colab:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span> pip install transformers datasets evaluate</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> os</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">&quot;SemEval2020-Task4-Data/ALL data/Training  Data/subtaskC_data_all.csv&quot;</span>):</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">!</span> git clone https:<span class="op">//</span>github.com<span class="op">/</span>wangcunxiang<span class="op">/</span>SemEval2020<span class="op">-</span>Task4<span class="op">-</span>Commonsense<span class="op">-</span>Validation<span class="op">-</span><span class="kw">and</span><span class="op">-</span>Explanation.git SemEval2020<span class="op">-</span>Task4<span class="op">-</span>Data</span></code></pre></div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="U1c3v4XVDfhz">
<p>You will use the following objects and functions:</p>
</div>
<div class="cell code" data-execution_count="7" data-deletable="false"
data-editable="false" id="Nef4cdirDfhz">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> evaluate</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasets <span class="im">import</span> Dataset</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> (AutoTokenizer, AutoModelForSeq2SeqLM,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                          Seq2SeqTrainingArguments, Seq2SeqTrainer,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                          DataCollatorForSeq2Seq, enable_full_determinism)</span></code></pre></div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="rjm8g6k8Dfhz">
<p>When working with Neural Networks, there are a large number of random
operations such as initializing the weights of the network, shuffling
the data for training, or choosing samples. This causes that different
training runs of the same model can lead to different results. To ensure
reproducibility, i.e. obtaining the same results in the different runs,
the random number generator must be initialized with a fixed value known
as seed. In Transformers, this can be done as follows:</p>
</div>
<div class="cell code" data-execution_count="8" data-deletable="false"
data-editable="false" id="9GC6UlXcDfh0">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>enable_full_determinism(seed<span class="op">=</span><span class="dv">42</span>)</span></code></pre></div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="J8U_rnboDfh0">
<blockquote>
<p><strong>Note!</strong> With models as complex as Neural Networks,
reproducibility is susceptible to factors such as software versions or
the hardware on which the models are run. Even with seed initialization,
there may be slight differences in the results.</p>
</blockquote>
<p>Working with Neural Networks also involves defining a number of
hyperparameters that set the configuration of the model. Finding the
appropriate hyperparameter values requires training the model with
different combinations and testing them on the development set. This
hyperparameter tuning is a costly process that needs multiple rounds of
experimentation. However, for this assignments, you will use the
following values:</p>
</div>
<div class="cell code" data-execution_count="9" data-deletable="false"
data-editable="false" id="8eBiASC4Dfh0">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">3</span>  <span class="co"># Number of epochs to train the model</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>train_batch_size <span class="op">=</span> <span class="dv">8</span>  <span class="co"># Number of examples used per gradient update</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">1e-5</span>  <span class="co"># The learning rate for the optimizer</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>max_length <span class="op">=</span> <span class="dv">25</span>  <span class="co"># Maximum lenght of the input sequence</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&quot;modelC&quot;</span>  <span class="co"># The output directory where the model will be written</span></span></code></pre></div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="eAd8K6wXDfh0">
<blockquote>
<p><strong>Note!</strong> The notebook for this assignment provides very
little guidance. You are expected to refer to the <a
href="https://huggingface.co/docs">documentation</a> for details on how
to solve the exercises.</p>
</blockquote>
</div>
<section id="loading-the-pre-trained-model---1-mark"
class="cell markdown" data-deletable="false" data-editable="false"
id="kGbzR7H8Dfh0">
<h2>Loading the Pre-trained Model - [1 Mark]</h2>
<p>The first step you must perform in this assignment is to load the
model and its corresponding tokenizer using the classes imported
above.</p>
</section>
<div class="cell code" data-execution_count="10" id="Yk7tOsLaDfh0">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_model(model_name):   <span class="co">#[1 Mark]</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load the tokenizer using the model name</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(model_name)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load the model for sequence-to-sequence</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> AutoModelForSeq2SeqLM.from_pretrained(model_name)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model, tokenizer</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="11"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:405,&quot;referenced_widgets&quot;:[&quot;c904c627434b450ea32f7fdeae2ba312&quot;,&quot;c9b933f0dd9e4023b49d4b8c2ada90ac&quot;,&quot;4cb84166d5844f9588b0827e62b522bf&quot;,&quot;97270eca156941f8949450569fafe33e&quot;,&quot;fac4290c955c46cb819fd273e3e8e9ce&quot;,&quot;72a5305bc2be4426861801fe31fcf781&quot;,&quot;ed85a33431d542729a4e32ef1155e1f2&quot;,&quot;f31cfcb159f7433487d3fb9c978dc8ed&quot;,&quot;e93990f4bbc74ff9b91cda3769f59a3d&quot;,&quot;ecfa7e4414254cf8a675c5d7dcca730d&quot;,&quot;7cce2c9506d144cb9ce51f4a4035a3d5&quot;,&quot;2a2dda96fb594ffab3e7b485bf60676a&quot;,&quot;2c8cfa703ef741f5a3904f9fedb09d2b&quot;,&quot;4662fb4e9fee4aaebb8b659e19b99241&quot;,&quot;52279633cc204f23b39ee550f4357991&quot;,&quot;b7b0feee04e54da6a1ae65a6b6a167ae&quot;,&quot;d2db7912692243b0974aed856a4c683c&quot;,&quot;5b4c77a50bb24d60a670cf75c4ed8715&quot;,&quot;dff5afa1e97d4adeae49a9f54681fb90&quot;,&quot;2ad0e82e439e421bb86438154ef1e36d&quot;,&quot;84a69c41225e414d8d3963aed995c8ba&quot;,&quot;3a715fff7c2f4636aa3921fb7e87b790&quot;,&quot;efb3fd528bf64d3d8ae59b3ae3dc4217&quot;,&quot;d0812f2310b3404f9e642a35059dc2cb&quot;,&quot;c9540f224ee44d658434e6fc06bbd9de&quot;,&quot;eff7ef6133654fe9ab479fde376c7d9d&quot;,&quot;d75bdfd9ca6748b6a78c4c4c2ea2d6a9&quot;,&quot;aa3cb8c1ed7846349f5d4b1c0ca68a7f&quot;,&quot;414d4d8fdc0b4e01b2c061544759b2a3&quot;,&quot;4f5f03f878e145059d5f2d624ed13449&quot;,&quot;05bcf519d7ec4b4d839096e726190500&quot;,&quot;f763e29b0a5346ed8e70e383d144024f&quot;,&quot;5bd94a9f62444b3fb2d2c78404680ce6&quot;,&quot;f2bc902c43984122834e83b0e840b904&quot;,&quot;f2252bc05a4a4cd490e3c47745f664db&quot;,&quot;75c01abe132f43ab8495d1be0e4e7b7a&quot;,&quot;7d1d518cdaf641179a948add847a680c&quot;,&quot;c8ad2d3fd82b4287b34ef726ab869a26&quot;,&quot;c7e2c5467b844eb09883d2302710a8e6&quot;,&quot;45aa3de211b54a9590e85930c473efe3&quot;,&quot;a3bd1908d51e434fa60ce674cd6b17ae&quot;,&quot;a24b06b3ab5b4c75a76e53eeedf56315&quot;,&quot;3574e262f3524f4c87a433508f2c52ea&quot;,&quot;46619359814c453697b84b7b7bcccfd2&quot;,&quot;9492d8d4537c4b7489112367fb399715&quot;,&quot;8269412113ed46b0af9718f526579b9e&quot;,&quot;645459a4355a40e39de4343645129224&quot;,&quot;6625eaf914464090bbc6b239e4841401&quot;,&quot;f7f464ac135d4be199b6e83eca53b685&quot;,&quot;213dae44b27b4a41b03a43a018f73f01&quot;,&quot;d31b2b624d6c4236aafe1ae09f65a27d&quot;,&quot;d98264d202c346da9db9f2f613dc54a3&quot;,&quot;81ee1dcbdb434d9480b11404423bb6e8&quot;,&quot;c36b1a7bfc484d29be78161ae47988f8&quot;,&quot;2cd6f7c754324b14a912427d3d151c5d&quot;]}"
data-deletable="false" data-editable="false" id="lEVPC3rlDfh0"
data-outputId="bae6c5a4-4ee8-4636-f0eb-54f72fc9f141">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="op">=</span> <span class="st">&quot;facebook/bart-base&quot;</span> <span class="cf">if</span> base_model <span class="cf">else</span> <span class="st">&quot;facebook/bart-large&quot;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>model, tokenizer <span class="op">=</span> load_model(model_name)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/usr/local/lib/python3.10/dist-packages/huggingface_hub/file_download.py:1132: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/huggingface_hub/utils/_token.py:89: UserWarning: 
The secret `HF_TOKEN` does not exist in your Colab secrets.
To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.
You will be able to reuse this secret in all of your notebooks.
Please note that authentication is recommended but still optional to access public models or datasets.
  warnings.warn(
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb11"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;c904c627434b450ea32f7fdeae2ba312&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb12"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;2a2dda96fb594ffab3e7b485bf60676a&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb13"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;efb3fd528bf64d3d8ae59b3ae3dc4217&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb14"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;f2bc902c43984122834e83b0e840b904&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stderr">
<pre><code>/usr/local/lib/python3.10/dist-packages/huggingface_hub/file_download.py:1132: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb16"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;9492d8d4537c4b7489112367fb399715&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stderr">
<pre><code>Some weights of BartForConditionalGeneration were not initialized from the model checkpoint at facebook/bart-base and are newly initialized: [&#39;encoder.embed_tokens.weight&#39;, &#39;decoder.embed_tokens.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
</code></pre>
</div>
</div>
<section id="data-pre-processing---2-marks" class="cell markdown"
data-deletable="false" data-editable="false" id="-q7CcBksDfh1">
<h2>Data Pre-processing - [2 Marks]</h2>
<p>The <strong>ComVE</strong> dataset consists of 10000 nonsensical
statements for the train set, 997 statements for development and 1000
for test. Each nonsensical statements comes with with three reference
valid reasons. You must load the three sets into three
<code>DataFrames</code>. For the training and development splits, the
<code>DataFrame</code> should contain three columns: the <code>id</code>
of the nonsensical statement, a <code>FalseSent</code> column with the
nonsensical statement and a <code>reason</code> column with the
reference reasons. For the test set, the <code>DataFrame</code> should
contain five columns: the <code>id</code> of the nonsensical statement,
a <code>FalseSent</code> column with the nonsensical statement and three
columns (<code>reason1</code>, <code>reason2</code> and
<code>reason3</code>) containing each of the reference reasons.</p>
<p>Train DataFrame:</p>
<table>
<colgroup>
<col style="width: 4%" />
<col style="width: 4%" />
<col style="width: 35%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: right;">id</th>
<th style="text-align: left;">FalseSent</th>
<th style="text-align: left;">reason</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">769</td>
<td style="text-align: right;">769</td>
<td style="text-align: left;">Computers is an ingredient used in
preparing food</td>
<td style="text-align: left;">Computers are not used for food and they
are not edible</td>
</tr>
<tr class="even">
<td style="text-align: right;">10769</td>
<td style="text-align: right;">769</td>
<td style="text-align: left;">Computers is an ingredient used in
preparing food</td>
<td style="text-align: left;">Computer is not something that can be used
in preparing food.</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20769</td>
<td style="text-align: right;">769</td>
<td style="text-align: left;">Computers is an ingredient used in
preparing food</td>
<td style="text-align: left;">You cannot eat a computer</td>
</tr>
<tr class="even">
<td style="text-align: right;">888</td>
<td style="text-align: right;">888</td>
<td style="text-align: left;">he did hear music in his cooling
glass</td>
<td style="text-align: left;">cooling glass can not play the song, it's
not a electronic thing to play music</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10888</td>
<td style="text-align: right;">888</td>
<td style="text-align: left;">he did hear music in his cooling
glass</td>
<td style="text-align: left;">Glass does not produce music.</td>
</tr>
<tr class="even">
<td style="text-align: right;">20888</td>
<td style="text-align: right;">888</td>
<td style="text-align: left;">he did hear music in his cooling
glass</td>
<td style="text-align: left;">Any sound that might be made by a cooling
glass is not music.</td>
</tr>
</tbody>
</table>
<p>Test DataFrame:</p>
<table>
<colgroup>
<col style="width: 2%" />
<col style="width: 2%" />
<col style="width: 19%" />
<col style="width: 24%" />
<col style="width: 23%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: right;">id</th>
<th style="text-align: left;">FalseSent</th>
<th style="text-align: left;">reason1</th>
<th style="text-align: left;">reason2</th>
<th style="text-align: left;">reason3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">76</td>
<td style="text-align: right;">1280</td>
<td style="text-align: left;">Beer that is drunk by humans is white</td>
<td style="text-align: left;">Beer is made of barley and it is a yellow
drink</td>
<td style="text-align: left;">A beer that is drunk by humans is not
white.</td>
<td style="text-align: left;">Beer is brown</td>
</tr>
<tr class="even">
<td style="text-align: right;">101</td>
<td style="text-align: right;">860</td>
<td style="text-align: left;">eating trash food every day makes you
stronger</td>
<td style="text-align: left;">eating trash food every day makes your
body fat and weak</td>
<td style="text-align: left;">eating trash food every day is bad for
your health</td>
<td style="text-align: left;">Trash food could be contaminated</td>
</tr>
<tr class="odd">
<td style="text-align: right;">136</td>
<td style="text-align: right;">777</td>
<td style="text-align: left;">he put some cooking oil in his wine</td>
<td style="text-align: left;">cooking oil will destroy the taste of the
wine</td>
<td style="text-align: left;">Cooking oil does not go in wine</td>
<td style="text-align: left;">Cooking oil does not taste nice and
therefore would ruin the wine.</td>
</tr>
<tr class="even">
<td style="text-align: right;">174</td>
<td style="text-align: right;">570</td>
<td style="text-align: left;">Lobsters live in the mountains</td>
<td style="text-align: left;">Lobsters needs water to live</td>
<td style="text-align: left;">Lobsters live in the sea.</td>
<td style="text-align: left;">Lobsters live in the sea, not the
mountains</td>
</tr>
<tr class="odd">
<td style="text-align: right;">210</td>
<td style="text-align: right;">1929</td>
<td style="text-align: left;">the clock shows animals</td>
<td style="text-align: left;">the clock is used to show the time to
people</td>
<td style="text-align: left;">Clocks are required to tell the time, not
show animals</td>
<td style="text-align: left;">a clock shows the time not animals</td>
</tr>
<tr class="even">
<td style="text-align: right;">235</td>
<td style="text-align: right;">1619</td>
<td style="text-align: left;">she put the giraffe in the freezer</td>
<td style="text-align: left;">A giraffe is much bigger than the
freezer</td>
<td style="text-align: left;">There is no way a giraffe is fitting in
the freezer.</td>
<td style="text-align: left;">A giraffe is too big to be put in a
freezer.</td>
</tr>
</tbody>
</table>
</section>
<div class="cell code" data-execution_count="12" id="GVeX5et-Dfh1">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data(data_csv, answers_csv, is_test<span class="op">=</span><span class="va">False</span>):   <span class="co"># 1 Mark</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load data_csv</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pd.read_csv(data_csv).dropna()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load answers_csv with no header and specified column names</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    answers <span class="op">=</span> pd.read_csv(answers_csv, header<span class="op">=</span><span class="va">None</span>).rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">&quot;id&quot;</span>, <span class="dv">1</span>: <span class="st">&quot;reason1&quot;</span>, <span class="dv">2</span>:<span class="st">&quot;reason2&quot;</span>, <span class="dv">3</span>:<span class="st">&quot;reason3&quot;</span>})</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge the data_csv and answers_csv data on &#39;id&#39; column</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="op">=</span> pd.merge(data, answers, on<span class="op">=</span><span class="st">&#39;id&#39;</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_test:</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> merged_df</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Reshape the DataFrame to have a single reason column</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>      reshaped_df <span class="op">=</span> pd.melt(merged_df, id_vars<span class="op">=</span>[<span class="st">&#39;id&#39;</span>, <span class="st">&#39;FalseSent&#39;</span>], value_vars<span class="op">=</span>[<span class="st">&#39;reason1&#39;</span>, <span class="st">&#39;reason2&#39;</span>, <span class="st">&#39;reason3&#39;</span>],</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                              var_name<span class="op">=</span><span class="st">&#39;reason_type&#39;</span>, value_name<span class="op">=</span><span class="st">&#39;reason&#39;</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Sort by &#39;id&#39; and &#39;reason_type&#39;</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>      reshaped_df.sort_values([<span class="st">&#39;id&#39;</span>, <span class="st">&#39;reason_type&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Drop the &#39;reason_type&#39; column as it&#39;s no longer needed</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>      reshaped_df.drop(columns<span class="op">=</span>[<span class="st">&#39;reason_type&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> reshaped_df</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="14"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:718}"
data-deletable="false" data-editable="false" id="tE231iQzDfh1"
data-outputId="80c6abb2-f929-4359-faff-3e6d63e07ce8">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>train_data_csv <span class="op">=</span> <span class="st">&quot;/content/subtaskC_data_all.csv&quot;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>train_answers_csv <span class="op">=</span> <span class="st">&quot;/content/subtaskC_answers_all.csv&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> load_data(train_data_csv, train_answers_csv)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>dev_data_csv <span class="op">=</span> <span class="st">&quot;/content/subtaskC_dev_data.csv&quot;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>dev_answers_csv <span class="op">=</span> <span class="st">&quot;/content/subtaskC_gold_answers.csv&quot;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>dev_data <span class="op">=</span> load_data(dev_data_csv, dev_answers_csv)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>test_data_csv <span class="op">=</span> <span class="st">&quot;/content/subtaskC_test_data.csv&quot;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>test_answers_csv <span class="op">=</span> <span class="st">&quot;/content/subtaskC_test_gold_answers.csv&quot;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> load_data(test_data_csv, test_answers_csv, <span class="va">True</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> shrink_dataset:</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> train_data[<span class="st">&quot;id&quot;</span>].sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).unique()[:<span class="dv">30</span>]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    train_data <span class="op">=</span> train_data[train_data.<span class="bu">id</span>.isin(idxs)]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> dev_data[<span class="st">&quot;id&quot;</span>].sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).unique()[:<span class="dv">30</span>]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    dev_data <span class="op">=</span> dev_data[dev_data.<span class="bu">id</span>.isin(idxs)]</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> test_data[<span class="st">&quot;id&quot;</span>].sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).unique()[:<span class="dv">30</span>]</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    test_data <span class="op">=</span> test_data[test_data.<span class="bu">id</span>.isin(idxs)]</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&quot;display.max_colwidth&quot;</span>, <span class="va">None</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Train DataFrame:&quot;</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>display(train_data[:<span class="dv">6</span>])</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Test DataFrame:&quot;</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>display(test_data[:<span class="dv">6</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Train DataFrame:
</code></pre>
</div>
<div class="output display_data">

  <div id="df-a326ff77-f3ab-4023-a44c-6d8befa55352" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>FalseSent</th>
      <th>reason</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>769</th>
      <td>769</td>
      <td>Computers is an ingredient used in preparing food</td>
      <td>Computers are not used for food and they are not edible</td>
    </tr>
    <tr>
      <th>10769</th>
      <td>769</td>
      <td>Computers is an ingredient used in preparing food</td>
      <td>Computer is not something that can be used in preparing food.</td>
    </tr>
    <tr>
      <th>20769</th>
      <td>769</td>
      <td>Computers is an ingredient used in preparing food</td>
      <td>You cannot eat a computer</td>
    </tr>
    <tr>
      <th>888</th>
      <td>888</td>
      <td>he did hear music in his cooling glass</td>
      <td>cooling glass can not play the song, it's not a electronic thing to play music</td>
    </tr>
    <tr>
      <th>10888</th>
      <td>888</td>
      <td>he did hear music in his cooling glass</td>
      <td>Glass does not produce music.</td>
    </tr>
    <tr>
      <th>20888</th>
      <td>888</td>
      <td>he did hear music in his cooling glass</td>
      <td>Any sound that might be made by a cooling glass is not music.</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-a326ff77-f3ab-4023-a44c-6d8befa55352')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-a326ff77-f3ab-4023-a44c-6d8befa55352 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-a326ff77-f3ab-4023-a44c-6d8befa55352');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-df242b6a-161f-4b18-a8c6-828aa3ecfe19">
  <button class="colab-df-quickchart" onclick="quickchart('df-df242b6a-161f-4b18-a8c6-828aa3ecfe19')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-df242b6a-161f-4b18-a8c6-828aa3ecfe19 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
<div class="output stream stdout">
<pre><code>Test DataFrame:
</code></pre>
</div>
<div class="output display_data">

  <div id="df-342c3276-b9cf-4759-8df5-6c22988c7f92" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>FalseSent</th>
      <th>reason1</th>
      <th>reason2</th>
      <th>reason3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>76</th>
      <td>1280</td>
      <td>Beer that is drunk by humans is white</td>
      <td>Beer is made of barley and it is a yellow drink</td>
      <td>A beer that is drunk by humans is not white.</td>
      <td>Beer is brown</td>
    </tr>
    <tr>
      <th>101</th>
      <td>860</td>
      <td>eating trash food every day makes you stronger</td>
      <td>eating trash food every day makes your body fat and weak</td>
      <td>eating trash food every day is bad for your health</td>
      <td>Trash food could be contaminated</td>
    </tr>
    <tr>
      <th>136</th>
      <td>777</td>
      <td>he put some cooking oil in his wine</td>
      <td>cooking oil will destroy the taste of the wine</td>
      <td>Cooking oil does not go in wine</td>
      <td>Cooking oil does not taste nice and therefore would ruin the wine.</td>
    </tr>
    <tr>
      <th>174</th>
      <td>570</td>
      <td>Lobsters live in the mountains</td>
      <td>Lobsters needs water to live</td>
      <td>Lobsters live in the sea.</td>
      <td>Lobsters live in the sea, not the mountains</td>
    </tr>
    <tr>
      <th>210</th>
      <td>1929</td>
      <td>the clock shows animals</td>
      <td>the clock is used to show the time to people</td>
      <td>Clocks are required to tell the time, not show animals</td>
      <td>a clock shows the time not animals</td>
    </tr>
    <tr>
      <th>235</th>
      <td>1619</td>
      <td>she put the giraffe in the freezer</td>
      <td>A giraffe is much bigger than the freezer</td>
      <td>There is no way a giraffe is fitting in the freezer.</td>
      <td>A giraffe is too big to be put in a freezer.</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-342c3276-b9cf-4759-8df5-6c22988c7f92')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-342c3276-b9cf-4759-8df5-6c22988c7f92 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-342c3276-b9cf-4759-8df5-6c22988c7f92');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-ad44e768-8185-4911-8ae0-c9e9e6785299">
  <button class="colab-df-quickchart" onclick="quickchart('df-ad44e768-8185-4911-8ae0-c9e9e6785299')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-ad44e768-8185-4911-8ae0-c9e9e6785299 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="15"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:225}"
data-deletable="false" data-editable="false" id="DJU-01EtDfh1"
data-outputId="93f3db16-02e0-40e3-f8c5-6ab4da3a0752">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> Dataset.from_pandas(train_data)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dev_dataset <span class="op">=</span> Dataset.from_pandas(dev_data)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> Dataset.from_pandas(test_data)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Train Dataset example:&quot;</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>display(train_dataset[<span class="dv">0</span>])</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Test Dataset example:&quot;</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>display(test_dataset[<span class="dv">0</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Train Dataset example:
</code></pre>
</div>
<div class="output display_data">
<pre><code>{&#39;id&#39;: 769,
 &#39;FalseSent&#39;: &#39;Computers is an ingredient used in preparing food&#39;,
 &#39;reason&#39;: &#39;Computers are not used for food and they are not edible&#39;,
 &#39;__index_level_0__&#39;: 769}</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Test Dataset example:
</code></pre>
</div>
<div class="output display_data">
<pre><code>{&#39;id&#39;: 1280,
 &#39;FalseSent&#39;: &#39;Beer that is drunk by humans is white&#39;,
 &#39;reason1&#39;: &#39;Beer is made of barley and it is a yellow drink&#39;,
 &#39;reason2&#39;: &#39;A beer that is drunk by humans is not white.&#39;,
 &#39;reason3&#39;: &#39;Beer is brown&#39;,
 &#39;__index_level_0__&#39;: 76}</code></pre>
</div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="HsEcHmGiDfh1">
<p>The <code>Datasets</code> should be pre-processed following two
different approaches. For the test <code>Dataset</code>, you must run
the tokenizer on the <code>FalseSent</code> column and store the result
in the <code>input_ids</code> and <code>attention_mask</code> fields.
For the train and development <code>Datasets</code> you must also run
the tokenizer on the <code>reason</code> column and store the resulting
<code>input_ids</code> in the <code>labels</code> field. In all cases,
the tokenizer must pad and truncate the sequences to the
<code>max_length</code> value.</p>
<blockquote>
<pre>
Train formated Dataset example:

{'id': 769, 'FalseSent': 'Computers is an ingredient used in preparing food', 'reason': 'Computers are not used for food and they are not edible', '__index_level_0__': 769, 'input_ids': [0, 14721, 43990, 16, 41, 16181, 341, 11, 4568, 689, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], 'labels': [0, 14721, 43990, 32, 45, 341, 13, 689, 8, 51, 32, 45, 27532, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}

Test formated Dataset example:

{'id': 1280, 'FalseSent': 'Beer that is drunk by humans is white', 'reason1': 'Beer is made of barley and it is a yellow drink', 'reason2': 'A beer that is drunk by humans is not white.', 'reason3': 'Beer is brown', '__index_level_0__': 76, 'input_ids': [0, 45562, 14, 16, 10789, 30, 5868, 16, 1104, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], 'attention_mask': [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}
</pre>
</blockquote>
</div>
<div class="cell code" data-execution_count="18" id="Y17HBOk0Dfh1">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> BatchEncoding</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_data(examples, tokenizer, max_length, is_test<span class="op">=</span><span class="va">False</span>):   <span class="co"># [1 Mark]</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tokenize the FalseSent column</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    tokenized_false_sent <span class="op">=</span> tokenizer(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        examples[<span class="st">&quot;FalseSent&quot;</span>],</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        padding<span class="op">=</span><span class="st">&quot;max_length&quot;</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        truncation<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        max_length<span class="op">=</span>max_length,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        return_tensors<span class="op">=</span><span class="st">&quot;pt&quot;</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the batch dictionary with input_ids and attention_mask</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    batch <span class="op">=</span> {</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;input_ids&quot;</span>: tokenized_false_sent[<span class="st">&quot;input_ids&quot;</span>],</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;attention_mask&quot;</span>: tokenized_false_sent[<span class="st">&quot;attention_mask&quot;</span>],</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> is_test:</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For train/dev data, tokenize the reason column</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        tokenized_reasons <span class="op">=</span> tokenizer(</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>            examples[<span class="st">&quot;reason&quot;</span>],</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>            padding<span class="op">=</span><span class="st">&quot;max_length&quot;</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>            truncation<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>            max_length<span class="op">=</span>max_length,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>            return_tensors<span class="op">=</span><span class="st">&quot;pt&quot;</span>,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add labels to the batch dictionary</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        batch[<span class="st">&quot;labels&quot;</span>] <span class="op">=</span> tokenized_reasons[<span class="st">&quot;input_ids&quot;</span>]</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the tokenized batch as a BatchEncoding object</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> BatchEncoding(batch)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="19"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:158,&quot;referenced_widgets&quot;:[&quot;3e2d3040c58d4188a9a4a17099e924df&quot;,&quot;3cfebf4d16204cfb9a628d7def7b8a93&quot;,&quot;3793b96f2e204e51ae273595f7ad8303&quot;,&quot;7c5358d2223a415b8366eee54cb79805&quot;,&quot;0ec7db90d7a3410ba74fcdc01d5ea1ae&quot;,&quot;4ea0502ac2e34dddbf487bbab4a79047&quot;,&quot;3d49c2e8886d462cb4f13c26fa8e7879&quot;,&quot;1a970b1b36a04e5b96278aa6e8e4b6ff&quot;,&quot;e7567402a7bc4a708ed8c5601367f9b4&quot;,&quot;76389f8a783c463b97d422b467df8611&quot;,&quot;e68adc26880e4bc99eead4959fa8370a&quot;,&quot;ac8fb6cb1ffd44aea7840e27bb719506&quot;,&quot;bfa8f5fc9b2c4cf69c07853ea5c75b23&quot;,&quot;93eeec87ea974b5698f3825b7374b09a&quot;,&quot;1fccc659ecff4a1a879d532e809cf121&quot;,&quot;2367d7a26b974fa5a612a8005d47a5c4&quot;,&quot;16ea0067134b4c4e9b4ed56b74c3a77a&quot;,&quot;bb705c21ccf14088b1330476c6cf0a96&quot;,&quot;cbdfc88db1b14b5e9c449f946f3ef914&quot;,&quot;e466ff3466f44fb89eef304aae009326&quot;,&quot;ba722ab7c099419497e9eda0f9cd9aa7&quot;,&quot;7d3335d1ec1a42f9802a33bfd3e47c55&quot;,&quot;23feef94c4544f54bb0a4268133bbe88&quot;,&quot;47e1fad2698d4eecb0b0c6ad598f0d08&quot;,&quot;27dea34b7f43419cb351f639ecf892aa&quot;,&quot;04f2c0d024cd44d684ca6bc0a3ab34a4&quot;,&quot;4c41de33d9e34b9e8bec2f1112a715c2&quot;,&quot;5b3c79ac9ad64c69aebe1ac4683ce525&quot;,&quot;0bd4f32da9df4186a8c5387dee86c00f&quot;,&quot;fcdb1100e36e47098d637f5dd80a0624&quot;,&quot;d99f28aaf04e430a881b8679843afb67&quot;,&quot;d8d98385754f4d73b8e7161553836abe&quot;,&quot;e8a76847054d45b3afcf6942be015e4c&quot;]}"
data-deletable="false" data-editable="false" id="TYDVjG1SDfh1"
data-outputId="ca3a1288-6d8f-4397-fc3f-b8982e5b2c33">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> train_dataset.<span class="bu">map</span>(<span class="kw">lambda</span> x: preprocess_data(x, tokenizer, max_length), batched<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dev_dataset <span class="op">=</span> dev_dataset.<span class="bu">map</span>(<span class="kw">lambda</span> x: preprocess_data(x, tokenizer, max_length), batched<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> test_dataset.<span class="bu">map</span>(<span class="kw">lambda</span> x: preprocess_data(x, tokenizer, max_length, <span class="va">True</span>), batched<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Train formated Dataset example:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_dataset[<span class="dv">0</span>])</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Test formated Dataset example:</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test_dataset[<span class="dv">0</span>])</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb29"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;3e2d3040c58d4188a9a4a17099e924df&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb30"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;ac8fb6cb1ffd44aea7840e27bb719506&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb31"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;23feef94c4544f54bb0a4268133bbe88&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>Train formated Dataset example:

{&#39;id&#39;: 769, &#39;FalseSent&#39;: &#39;Computers is an ingredient used in preparing food&#39;, &#39;reason&#39;: &#39;Computers are not used for food and they are not edible&#39;, &#39;__index_level_0__&#39;: 769, &#39;input_ids&#39;: [0, 14721, 43990, 16, 41, 16181, 341, 11, 4568, 689, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], &#39;attention_mask&#39;: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], &#39;labels&#39;: [0, 14721, 43990, 32, 45, 341, 13, 689, 8, 51, 32, 45, 27532, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}

Test formated Dataset example:

{&#39;id&#39;: 1280, &#39;FalseSent&#39;: &#39;Beer that is drunk by humans is white&#39;, &#39;reason1&#39;: &#39;Beer is made of barley and it is a yellow drink&#39;, &#39;reason2&#39;: &#39;A beer that is drunk by humans is not white.&#39;, &#39;reason3&#39;: &#39;Beer is brown&#39;, &#39;__index_level_0__&#39;: 76, &#39;input_ids&#39;: [0, 45562, 14, 16, 10789, 30, 5868, 16, 1104, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1], &#39;attention_mask&#39;: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}
</code></pre>
</div>
</div>
<section id="fine-tuning---5-marks" class="cell markdown"
data-deletable="false" data-editable="false" id="SE65PJbXDfh2">
<h2>Fine-tuning - [5 Marks]</h2>
<p>In general, when using a <code>Trainer</code> to make predictions, it
returns the logits for each class in the task. However, the
<code>Seq2SeqTrainingArguments</code> class provides an option that
allows the <code>Trainer</code> to generate sequences of tokens in the
prediction. The <code>create_training_arguments</code> function must
create the <code>Seq2SeqTrainingArguments</code> with that option and
the hyperparamters passed as arguments. During the training, the model
must be evaluated on the development set after every epoch.
<code>TrainingArguments</code> should include this strategy.</p>
<blockquote>
<p><strong>Important!</strong> By default, <code>Trainer</code> saves a
checkpoint of the model every 500 training steps. For this assignment,
avoid this behavior by setting <code>save_strategy="no"</code> when
creating the <code>TrainingArguments</code>.</p>
</blockquote>
</section>
<div class="cell code" data-execution_count="27" id="NYcGf9LtDfh2">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_training_arguments(epochs, train_batch_size, learning_rate, output_dir):   <span class="co"># [1 Mark]</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    training_args <span class="op">=</span> Seq2SeqTrainingArguments(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        output_dir<span class="op">=</span>output_dir,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        num_train_epochs<span class="op">=</span>epochs,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        per_device_train_batch_size<span class="op">=</span>train_batch_size,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        learning_rate<span class="op">=</span>learning_rate,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        evaluation_strategy<span class="op">=</span><span class="st">&quot;epoch&quot;</span>,  <span class="co"># Evaluate after every epoch</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        save_strategy<span class="op">=</span><span class="st">&quot;no&quot;</span>,  <span class="co"># Do not save checkpoints every 500 steps</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        predict_with_generate<span class="op">=</span><span class="va">True</span>,  <span class="co"># Generate sequences during prediction</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> training_args</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="28"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-deletable="false" data-editable="false" id="OMIWd-JsDfh2"
data-outputId="8db26bc0-c084-4715-c5dd-6ec6eea5ebdc">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>train_args <span class="op">=</span> create_training_arguments(epochs, train_batch_size, learning_rate, output_dir)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>PyTorch: setting up devices
The default value for the training argument `--report_to` will change in v5 (from all installed integrations to none). In v5, you will need to use `--report_to all` to get the same behavior as now. You should start updating your code and make this info disappear :-).
</code></pre>
</div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="LlaJ4yJxDfh2">
<p>Next, you can create a <code>Trainer</code> object initializing the
appropriate data collator.</p>
</div>
<div class="cell code" data-execution_count="29" id="b3Zqw2vpDfh2">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_trainer(model, train_args, train_dataset, dev_dataset, tokenizer):   <span class="co"># [1 Mark]</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize the data collator for Seq2Seq tasks</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    data_collator <span class="op">=</span> DataCollatorForSeq2Seq(tokenizer, model<span class="op">=</span>model)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create and return the Trainer object</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    trainer <span class="op">=</span> Seq2SeqTrainer(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>model,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        args<span class="op">=</span>train_args,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        train_dataset<span class="op">=</span>train_dataset,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        eval_dataset<span class="op">=</span>dev_dataset,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        tokenizer<span class="op">=</span>tokenizer,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        data_collator<span class="op">=</span>data_collator,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trainer</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="30" data-deletable="false"
data-editable="false" id="3E2txek_Dfh2">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> create_trainer(model, train_args, train_dataset, dev_dataset, tokenizer)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="31"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:675}"
data-deletable="false" data-editable="false" id="wtQpnSvdDfh2"
data-outputId="f45c5187-9690-4410-9bd3-dbf6b80f3132">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>trainer.train()</span></code></pre></div>
<div class="output stream stderr">
<pre><code>The following columns in the training set don&#39;t have a corresponding argument in `BartForConditionalGeneration.forward` and have been ignored: FalseSent, reason, __index_level_0__, id. If FalseSent, reason, __index_level_0__, id are not expected by `BartForConditionalGeneration.forward`,  you can safely ignore this message.
***** Running training *****
  Num examples = 90
  Num Epochs = 3
  Instantaneous batch size per device = 8
  Total train batch size (w. parallel, distributed &amp; accumulation) = 8
  Gradient Accumulation steps = 1
  Total optimization steps = 36
</code></pre>
</div>
<div class="output display_data">

    <div>
      
      <progress value='36' max='36' style='width:300px; height:20px; vertical-align: middle;'></progress>
      [36/36 02:12, Epoch 3/3]
    </div>
    <table border="1" class="dataframe">
  <thead>
 <tr style="text-align: left;">
      <th>Epoch</th>
      <th>Training Loss</th>
      <th>Validation Loss</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>No log</td>
      <td>7.002179</td>
    </tr>
    <tr>
      <td>2</td>
      <td>No log</td>
      <td>6.461193</td>
    </tr>
    <tr>
      <td>3</td>
      <td>No log</td>
      <td>6.248329</td>
    </tr>
  </tbody>
</table><p>
</div>
<div class="output stream stderr">
<pre><code>The following columns in the evaluation set don&#39;t have a corresponding argument in `BartForConditionalGeneration.forward` and have been ignored: FalseSent, reason, __index_level_0__, id. If FalseSent, reason, __index_level_0__, id are not expected by `BartForConditionalGeneration.forward`,  you can safely ignore this message.
***** Running Evaluation *****
  Num examples = 90
  Batch size = 8
The following columns in the evaluation set don&#39;t have a corresponding argument in `BartForConditionalGeneration.forward` and have been ignored: FalseSent, reason, __index_level_0__, id. If FalseSent, reason, __index_level_0__, id are not expected by `BartForConditionalGeneration.forward`,  you can safely ignore this message.
***** Running Evaluation *****
  Num examples = 90
  Batch size = 8
The following columns in the evaluation set don&#39;t have a corresponding argument in `BartForConditionalGeneration.forward` and have been ignored: FalseSent, reason, __index_level_0__, id. If FalseSent, reason, __index_level_0__, id are not expected by `BartForConditionalGeneration.forward`,  you can safely ignore this message.
***** Running Evaluation *****
  Num examples = 90
  Batch size = 8


Training completed. Do not forget to share your model on huggingface.co/models =)


</code></pre>
</div>
<div class="output execute_result" data-execution_count="31">
<pre><code>TrainOutput(global_step=36, training_loss=7.199645148383246, metrics={&#39;train_runtime&#39;: 135.7905, &#39;train_samples_per_second&#39;: 1.988, &#39;train_steps_per_second&#39;: 0.265, &#39;total_flos&#39;: 4019258880000.0, &#39;train_loss&#39;: 7.199645148383246, &#39;epoch&#39;: 3.0})</code></pre>
</div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="e7Dq4Z3QDfh2">
<p>If you have set the <code>Seq2SeqTrainingArguments</code> properly,
you could now use the <code>Trainer</code> to predict sequences of
tokens. Take into account that <code>Trainer</code> will return the
indexes of the tokens, so the sequence must be decoded to obtain the
text strings. The <code>tokenizer</code> provides functionality to do
this. The result of this process can be stored in the
<code>prediction</code> column of the test <code>DataFrame</code>:</p>
<table style="width:100%;">
<colgroup>
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 16%" />
<col style="width: 20%" />
<col style="width: 19%" />
<col style="width: 23%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: right;">id</th>
<th style="text-align: left;">FalseSent</th>
<th style="text-align: left;">reason1</th>
<th style="text-align: left;">reason2</th>
<th style="text-align: left;">reason3</th>
<th style="text-align: left;">prediction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">76</td>
<td style="text-align: right;">1280</td>
<td style="text-align: left;">Beer that is drunk by humans is white</td>
<td style="text-align: left;">Beer is made of barley and it is a yellow
drink</td>
<td style="text-align: left;">A beer that is drunk by humans is not
white.</td>
<td style="text-align: left;">Beer is brown</td>
<td style="text-align: left;">Beer that is drunk by humans is white</td>
</tr>
<tr class="even">
<td style="text-align: right;">101</td>
<td style="text-align: right;">860</td>
<td style="text-align: left;">eating trash food every day makes you
stronger</td>
<td style="text-align: left;">eating trash food every day makes your
body fat and weak</td>
<td style="text-align: left;">eating trash food every day is bad for
your health</td>
<td style="text-align: left;">Trash food could be contaminated</td>
<td style="text-align: left;">eating trash food every day makes you
stronger</td>
</tr>
<tr class="odd">
<td style="text-align: right;">136</td>
<td style="text-align: right;">777</td>
<td style="text-align: left;">he put some cooking oil in his wine</td>
<td style="text-align: left;">cooking oil will destroy the taste of the
wine</td>
<td style="text-align: left;">Cooking oil does not go in wine</td>
<td style="text-align: left;">Cooking oil does not taste nice and
therefore would ruin the wine.</td>
<td style="text-align: left;">he put some cooking oil in his wine</td>
</tr>
<tr class="even">
<td style="text-align: right;">174</td>
<td style="text-align: right;">570</td>
<td style="text-align: left;">Lobsters live in the mountains</td>
<td style="text-align: left;">Lobsters needs water to live</td>
<td style="text-align: left;">Lobsters live in the sea.</td>
<td style="text-align: left;">Lobsters live in the sea, not the
mountains</td>
<td style="text-align: left;">Lobsters live in mountains</td>
</tr>
<tr class="odd">
<td style="text-align: right;">210</td>
<td style="text-align: right;">1929</td>
<td style="text-align: left;">the clock shows animals</td>
<td style="text-align: left;">the clock is used to show the time to
people</td>
<td style="text-align: left;">Clocks are required to tell the time, not
show animals</td>
<td style="text-align: left;">a clock shows the time not animals</td>
<td style="text-align: left;">the clock shows animals</td>
</tr>
<tr class="even">
<td style="text-align: right;">235</td>
<td style="text-align: right;">1619</td>
<td style="text-align: left;">she put the giraffe in the freezer</td>
<td style="text-align: left;">A giraffe is much bigger than the
freezer</td>
<td style="text-align: left;">There is no way a giraffe is fitting in
the freezer.</td>
<td style="text-align: left;">A giraffe is too big to be put in a
freezer.</td>
<td style="text-align: left;">she put the giraffe in the freezer</td>
</tr>
</tbody>
</table>
</div>
<div class="cell code" data-execution_count="32" id="8igEq42FDfh2">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_predictions(trainer, test_dataset, tokenizer):   <span class="co"># [1 Mark]</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate predictions</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> trainer.predict(test_dataset)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the predicted token indices</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    predicted_token_indices <span class="op">=</span> predictions.predictions</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decode the token indices to text strings</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    decoded_predictions <span class="op">=</span> [tokenizer.decode(ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>) <span class="cf">for</span> ids <span class="kw">in</span> predicted_token_indices]</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> decoded_predictions</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="33"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
data-deletable="false" data-editable="false" id="zaptZPfJDfh2"
data-outputId="7ae58a80-235b-4d10-b80d-7074e527896f">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> make_predictions(trainer, test_dataset, tokenizer)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>test_data[<span class="st">&quot;prediction&quot;</span>] <span class="op">=</span> predictions</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>test_data</span></code></pre></div>
<div class="output stream stderr">
<pre><code>The following columns in the test set don&#39;t have a corresponding argument in `BartForConditionalGeneration.forward` and have been ignored: id, reason3, reason2, reason1, FalseSent, __index_level_0__. If id, reason3, reason2, reason1, FalseSent, __index_level_0__ are not expected by `BartForConditionalGeneration.forward`,  you can safely ignore this message.
***** Running Prediction *****
  Num examples = 30
  Batch size = 8
</code></pre>
</div>
<div class="output display_data">

</div>
<div class="output execute_result" data-execution_count="33">

  <div id="df-18bab222-8b86-4eac-94fd-3b41287396ad" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>FalseSent</th>
      <th>reason1</th>
      <th>reason2</th>
      <th>reason3</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>76</th>
      <td>1280</td>
      <td>Beer that is drunk by humans is white</td>
      <td>Beer is made of barley and it is a yellow drink</td>
      <td>A beer that is drunk by humans is not white.</td>
      <td>Beer is brown</td>
      <td>Beer is not white.</td>
    </tr>
    <tr>
      <th>101</th>
      <td>860</td>
      <td>eating trash food every day makes you stronger</td>
      <td>eating trash food every day makes your body fat and weak</td>
      <td>eating trash food every day is bad for your health</td>
      <td>Trash food could be contaminated</td>
      <td>eating trash food every day makes you stronger</td>
    </tr>
    <tr>
      <th>136</th>
      <td>777</td>
      <td>he put some cooking oil in his wine</td>
      <td>cooking oil will destroy the taste of the wine</td>
      <td>Cooking oil does not go in wine</td>
      <td>Cooking oil does not taste nice and therefore would ruin the wine.</td>
      <td>he put some cooking oil in his wine</td>
    </tr>
    <tr>
      <th>174</th>
      <td>570</td>
      <td>Lobsters live in the mountains</td>
      <td>Lobsters needs water to live</td>
      <td>Lobsters live in the sea.</td>
      <td>Lobsters live in the sea, not the mountains</td>
      <td>Lobsters live in the mountains</td>
    </tr>
    <tr>
      <th>210</th>
      <td>1929</td>
      <td>the clock shows animals</td>
      <td>the clock is used to show the time to people</td>
      <td>Clocks are required to tell the time, not show animals</td>
      <td>a clock shows the time not animals</td>
      <td>the clock shows animals</td>
    </tr>
    <tr>
      <th>235</th>
      <td>1619</td>
      <td>she put the giraffe in the freezer</td>
      <td>A giraffe is much bigger than the freezer</td>
      <td>There is no way a giraffe is fitting in the freezer.</td>
      <td>A giraffe is too big to be put in a freezer.</td>
      <td>she put the giraffe in the freezer</td>
    </tr>
    <tr>
      <th>280</th>
      <td>979</td>
      <td>he installed the carpet on the lake</td>
      <td>The carpet will absorb water and sink</td>
      <td>Carpets need a subfloor.</td>
      <td>A lake would not be able to grip onto carpet.</td>
      <td>he installed the carpet on the lake</td>
    </tr>
    <tr>
      <th>319</th>
      <td>75</td>
      <td>My son had us write an essay on The National Monument.</td>
      <td>My son isn't smart enough to assign an essay.</td>
      <td>My son is studying in the seconds standard only</td>
      <td>Children don't ask parents to write essays.</td>
      <td>My son had us write an essay on The National Monument.</td>
    </tr>
    <tr>
      <th>371</th>
      <td>1810</td>
      <td>He drove up the stairs to the bedroom</td>
      <td>A car is too large to fit upstairs</td>
      <td>Stairs are too small and weak for a car to drive up</td>
      <td>People don't drive up indoor stairs.</td>
      <td>He drove up the stairs to the bedroom</td>
    </tr>
    <tr>
      <th>411</th>
      <td>774</td>
      <td>he put a piece of plastic on the bread</td>
      <td>the plastic usually is toxic</td>
      <td>You can't eat plastic.</td>
      <td>People do not eat plastic because it's not a food</td>
      <td>he put a piece of plastic on the bread</td>
    </tr>
    <tr>
      <th>513</th>
      <td>1739</td>
      <td>My mom always cuts my fish's hair.</td>
      <td>Fish don't have any hair.</td>
      <td>Fish have scales instead of hair like we have</td>
      <td>Fish don't have hair.</td>
      <td>My mom always cuts my fish's hair.</td>
    </tr>
    <tr>
      <th>521</th>
      <td>324</td>
      <td>She put the filing cabinet into the papers.</td>
      <td>Nothing can be put into the paper.</td>
      <td>it doesnt fit into papers</td>
      <td>The filing cabinet is what papers go into.</td>
      <td>She put the filing cabinet into the papers.</td>
    </tr>
    <tr>
      <th>527</th>
      <td>6</td>
      <td>Grizzly bears hate honey.</td>
      <td>Honey is good for grizzly bear's growth</td>
      <td>Grizzly bears have been observed in the wild seeking out honey to eat</td>
      <td>Grizzly bears love honey.</td>
      <td>Grizzly bears hate honey.</td>
    </tr>
    <tr>
      <th>549</th>
      <td>901</td>
      <td>the baby held a grizzly bear</td>
      <td>a baby would be eaten by a grizzly bear</td>
      <td>Baby can hold a teddy bear but not grizzly bear.</td>
      <td>A grizzly bear is bigger than a baby and would eat a baby.</td>
      <td>the baby held a grizzly bear</td>
    </tr>
    <tr>
      <th>626</th>
      <td>343</td>
      <td>She throws a stove in the hat.</td>
      <td>A stove is bigger than a hat.</td>
      <td>stove is too big to fit in a hat</td>
      <td>Stove cannot be thrown in the hat</td>
      <td>She throws a stove in the hat.</td>
    </tr>
    <tr>
      <th>636</th>
      <td>1044</td>
      <td>fishing nets are useful for covering a window</td>
      <td>fishing nets have holes in them that leave gaps of a window uncovered</td>
      <td>Fishing net will smell so bad and look so unclean on a window.</td>
      <td>Nets don't block out light.</td>
      <td>fishing nets are useful for covering a window</td>
    </tr>
    <tr>
      <th>660</th>
      <td>207</td>
      <td>Pens are for painting</td>
      <td>Pens are a writing utensil</td>
      <td>Pens are not brushes.</td>
      <td>A pen is not made for painting.</td>
      <td>Pens are for painting</td>
    </tr>
    <tr>
      <th>678</th>
      <td>443</td>
      <td>My window speaks very well.</td>
      <td>Your window cannot speak because it is an object.</td>
      <td>windows dont talk</td>
      <td>a window does not have a voice</td>
      <td>My window speaks very well.</td>
    </tr>
    <tr>
      <th>737</th>
      <td>1455</td>
      <td>The lion used the litter box</td>
      <td>A domestic cat is tame and use litter boxes</td>
      <td>The lion is too big for a litter box</td>
      <td>litter boxes are only for cats</td>
      <td>The lion used the litter box</td>
    </tr>
    <tr>
      <th>740</th>
      <td>13</td>
      <td>Cigarette is good for healthy</td>
      <td>Lung will be damaged by smoking cigarette</td>
      <td>Cigarettes contain carcinogens.</td>
      <td>Cigarettes cause cancer.</td>
      <td>Cigarette is good for healthy</td>
    </tr>
    <tr>
      <th>761</th>
      <td>308</td>
      <td>Mike ran four sandwiches.</td>
      <td>You can't run a sandwich.</td>
      <td>A sandwich is not a distance</td>
      <td>Sandwich is food and not need to run for it.</td>
      <td>Mike ran four sandwiches.</td>
    </tr>
    <tr>
      <th>811</th>
      <td>1439</td>
      <td>The cat likes to watch alligators.</td>
      <td>Cats and alligators lives in different areas in the world</td>
      <td>Cats like to watch things they can eat.</td>
      <td>The cat likes to watch birds and not alligators.</td>
      <td>The cat likes to watch alligators.</td>
    </tr>
    <tr>
      <th>859</th>
      <td>1696</td>
      <td>The supermarket only sells cars</td>
      <td>They have a variety of goods and services in the supermarket, mainly household supplies</td>
      <td>A supermarket implies the sale of smaller goods like groceries or toiletries.</td>
      <td>Supermarkets don't sell cars.</td>
      <td>The supermarket only sells cars</td>
    </tr>
    <tr>
      <th>883</th>
      <td>1548</td>
      <td>The man ate the bowl when he was hungry.</td>
      <td>People cannot eat bowls.</td>
      <td>The bowl is not edible.</td>
      <td>One cannot eat a bowl</td>
      <td>The man ate the bowl when he was hungry.</td>
    </tr>
    <tr>
      <th>899</th>
      <td>863</td>
      <td>a flower petal is part of a motor vehicle</td>
      <td>a flower petal isn't a motor component</td>
      <td>A motor vehicle does not contain flower parts</td>
      <td>Petals aren't car parts.</td>
      <td>a flower petal is part of a motor vehicle</td>
    </tr>
    <tr>
      <th>902</th>
      <td>745</td>
      <td>Renting movies is the newest trend</td>
      <td>Fewer and fewer people like renting movies</td>
      <td>Renting has been around a long time.</td>
      <td>Renting movies is outdated and for something to be trending it must be popular</td>
      <td>Renting movies is the newest trend</td>
    </tr>
    <tr>
      <th>938</th>
      <td>1883</td>
      <td>People are usually green</td>
      <td>No one is born green</td>
      <td>People are not green.</td>
      <td>No existing human race has green skin.</td>
      <td>People are usually green</td>
    </tr>
    <tr>
      <th>947</th>
      <td>1030</td>
      <td>beepers are becoming even more popular</td>
      <td>no one uses beepers anymore</td>
      <td>The beeper trend died in the 90s.</td>
      <td>Beepers have gone out of style with all of the new available cell phones, so they are rarely used anymore.</td>
      <td>beepers are becoming even more popular</td>
    </tr>
    <tr>
      <th>973</th>
      <td>986</td>
      <td>the sun rises in the west</td>
      <td>the sun rises in the east and sets in the west</td>
      <td>It depends on the earth position</td>
      <td>The sun always sets in the west</td>
      <td>the sun rises in the west</td>
    </tr>
    <tr>
      <th>986</th>
      <td>905</td>
      <td>at night it's easy to find sun</td>
      <td>sun can be seen only during the day</td>
      <td>By definition night is after the sun has gone</td>
      <td>The sun is not out at night</td>
      <td>at night it's easy to find sun</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-18bab222-8b86-4eac-94fd-3b41287396ad')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-18bab222-8b86-4eac-94fd-3b41287396ad button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-18bab222-8b86-4eac-94fd-3b41287396ad');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-8e12b4e4-2910-4c2c-a106-99187ebfc805">
  <button class="colab-df-quickchart" onclick="quickchart('df-8e12b4e4-2910-4c2c-a106-99187ebfc805')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-8e12b4e4-2910-4c2c-a106-99187ebfc805 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_2ab1e5fa-1425-4655-891a-d9234bebdf8e">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('test_data')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_2ab1e5fa-1425-4655-891a-d9234bebdf8e button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('test_data');
      }
      })();
    </script>
  </div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="2gAv_hl0Dfh3">
<p>The <strong>Subtasks B</strong> of <strong>ComVE</strong> is
evaluated using the <em>bleu</em> metric. In this assignment, you will
also evaluate using <em>rouge</em>. With <code>shrink_dataset</code> and
<code>base_model</code> set to <code>True</code>, the expected scores
are <em>0.216</em> and <em>0.446</em> for <em>bleu</em> and
<em>rouge</em> respectively. With a full training run, i.e. with
<code>shrink_dataset</code> and <code>base_model</code> set to
<code>False</code>, the scores should be around <em>0.228</em> and
<em>0.461</em>.</p>
</div>
<div class="cell code" data-execution_count="36" id="yDJ79cPoDfh3">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_prediction(test_data, metric):   <span class="co"># [2 Marks]</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load metric for accuracy evaluation</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> evaluate.load(metric)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the evaluation score based on the metric</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> test_data[<span class="st">&quot;prediction&quot;</span>].values</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    references <span class="op">=</span> test_data[[<span class="st">&#39;reason1&#39;</span>, <span class="st">&#39;reason2&#39;</span>, <span class="st">&#39;reason3&#39;</span>]].values</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    evaluation_score <span class="op">=</span> accuracy.compute(predictions<span class="op">=</span>predictions, references<span class="op">=</span>references)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> evaluation_score</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="39"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-deletable="false" data-editable="false" id="MztCvvWyDfh3"
data-outputId="e4863176-4395-41c7-cffa-b84eb79a3ea4">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>evaluate_prediction(test_data, <span class="st">&quot;bleu&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="39">
<pre><code>{&#39;bleu&#39;: 0.21112609159643486,
 &#39;precisions&#39;: [0.5714285714285714,
  0.31213872832369943,
  0.13986013986013987,
  0.07964601769911504],
 &#39;brevity_penalty&#39;: 1.0,
 &#39;length_ratio&#39;: 1.16,
 &#39;translation_length&#39;: 203,
 &#39;reference_length&#39;: 175}</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="40"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-deletable="false" data-editable="false" id="7aIBv1uODfh3"
data-outputId="ebf6d81c-8205-4b0a-ffa2-231e0b655dac">
<div class="sourceCode" id="cb48"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>evaluate_prediction(test_data, <span class="st">&quot;rouge&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="40">
<pre><code>{&#39;rouge1&#39;: 0.4610998567422716,
 &#39;rouge2&#39;: 0.2491434815041626,
 &#39;rougeL&#39;: 0.4410703887329275,
 &#39;rougeLsum&#39;: 0.4410075373542866}</code></pre>
</div>
</div>
<div class="cell markdown" data-deletable="false" data-editable="false"
id="s0D-JhuDDfh3">
<p>The scores for the partial training and the full training are so
similar that it would appear that the full training does not provide any
benefit in this task. However, it should be noted that the test sets in
the two cases are different. More importantly, these results are
indicative of the limitations of metrics such as <em>bleu</em> and
<em>rouge</em> for evaluating text generation. Take, for example, the
following case from the test set:</p>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 33%" />
<col style="width: 23%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">FalseSent</th>
<th style="text-align: left;">reason1</th>
<th style="text-align: left;">reason2</th>
<th style="text-align: left;">reason3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Beer that is drunk by humans is white</td>
<td style="text-align: left;">Beer is made of barley and it is a yellow
drink</td>
<td style="text-align: left;">A beer that is drunk by humans is not
white.</td>
<td style="text-align: left;">Beer is brown</td>
</tr>
</tbody>
</table>
<p>The predictions obtained by the partial and full trainings and their
corresponding scores are the following:</p>
<table>
<colgroup>
<col style="width: 27%" />
<col style="width: 42%" />
<col style="width: 15%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">full training</th>
<th style="text-align: left;">prediction</th>
<th style="text-align: right;">bleu</th>
<th style="text-align: right;">rouge</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">no</td>
<td style="text-align: left;">Beer that is drunk by humans is white</td>
<td style="text-align: right;">0.731</td>
<td style="text-align: right;">0.889</td>
</tr>
<tr class="even">
<td style="text-align: left;">yes</td>
<td style="text-align: left;">White beer is not suitable for human
consumption.</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.364</td>
</tr>
</tbody>
</table>
<p>The text generated by the full training is a better explanation than
the reason generated by the partial training, which is a mere repetition
of the nonsensical statement. However, the latter obtains much better
scores than the former. Metrics such as <em>bleu</em> and <em>rouge</em>
do not always replace accurately the human judgement.</p>
</div>
</body>
</html>
